## 分布式系统的基石-TCP/IP协议

- **TCP/IP**

  TCP 协议能够检测和恢复IP 层提供的主机到主机的通信中可能发生的报文丢失、重复及其他错误。TCP 协议是一种面向连接的协议，在使用TCP进行通信之前，两个应用程序之间需要建立一个TCP 连接，而这个连接又涉及到两台电脑需要完成握手消息的交换。

  - **三次握手**

    ![1556076136756](C:\Users\xingwei.zhang\AppData\Roaming\Typora\typora-user-images\1556076136756.png)

  - **四次挥手**

  ![1556076184(1)](C:\Xingwei\Owner\Typora\Typora\Notebook\Distributed\images\1556076184(1).jpg)

- **UDP/IP**
  UDP 协议不会对IP 层产生的错误进行修复，而是简单的扩展了IP 协议“尽力而为”的数据报文服务，使他能够在应用程序之间工作，而不是在主机之间工作，因此使用UDP协议必须要考虑到报文丢失，顺序混乱的问题


- **为什么连接的时候是三次握手，关闭的时候却是四次握手？**
  三次握手是因为因为当Server 端收到Client 端的SYN 连接请求报文后，可以直接发送SYN+ACK 报文。其中ACK报文是用来应答的，SYN 报文是用来同步的。但是关闭连接时，当Server 端收到FIN 报文时，很可能并不会立即关闭SOCKET（因为可能还有消息没处理完），所以只能先回复一个ACK 报文，告诉Client 端，"你发的FIN 报文我收到了"。只有等到我Server 端所有的报文都发送完了，我才能发送FIN 报文，因此不能一起发送。故需要四步握手。

- **数据传输过程的流量控制和确认机制**
  建立可靠连接以后，就开始进行数据传输了。在通信过程中，最重要的是数据包，也就是协议传输的数据。如果数据的传送与接收过程当中出现收方来不及接收的情况，这时就需要对发方进行控制以免数据丢失。利用滑动窗口机制可以很方便的在TCP 连接上实现对发送方的流量控制。TCP 的窗口单位是字节，不是报文段，发送方的发送窗口不能超过接收方给出的接收窗口的数值。

  - **滑动窗口协议**
    滑动窗口（Sliding window）是一种流量控制技术。早期的网络通信中，通信双方不会考虑网络的拥挤情况直接发送数据。由于大家不知道网络拥塞状况，同时发送数据，导致中间节点阻塞掉包，谁也发不了数据，所以就有了滑动窗口机制来解决此问题；发送和接受方都会维护一个数据帧的序列，这个序列被称作窗口。
  - 简单解释下，发送和接受方都会维护一个数据帧的序列，这个序列被称作窗口。发送方的窗口大小由接受方确定，目的在于控制发送速度，以免接受方的缓存不够大，而导致溢出，同时控制流量也可以避免网络拥塞。下面图中的4,5,6 号数据帧已经被发送出去，但是未收到关联的ACK，7,8,9 帧则是等待发送。可以看出发送端的窗口大小为6，这是由接受端告知的。此时如果发送端收到4 号ACK，则窗口的左边缘向右收缩，窗口的右边缘则向右扩展，此时窗口就向前“滑动了”，即数据帧10 也可以被发送。

​        ![1556076423(1)](C:\Xingwei\Owner\Typora\Typora\Notebook\Distributed\images\1556076423(1).jpg)



- **广播**
  广播是主机向子网内所有主机发送消息，子网内所有主机都能收到来自某台主机的广播信息，属于点对所有点的通信。广播意味着网络向子网每一个主机都投递一份数据包，不论这些主机是否乐意接收该数据包;
- **多播**
  多播是主机向一组主机发送信息，存在于某个组的所有主机都可以接收到消息，属于点对多点的通信。